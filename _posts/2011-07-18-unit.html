---
title: "Когда unit-тестировать?!"
layout: "post"
permalink: "/2011/07/unit.html"
uuid: "6981912396432484664"
guid: "tag:blogger.com,1999:blog-1763451622132357586.post-6981912396432484664"
date: "2011-07-18 19:19:00"
updated: "2011-07-18 19:28:20"
description: 
blogger:
    siteid: "1763451622132357586"
    postid: "6981912396432484664"
    comments: "2"
tags: [unit testing]
comments: true
categories: [blog]
---

<div class="css-full-post-content js-full-post-content">
В который раз убедился, что многие разработчики не умеют писать элементарные unit тесты.&nbsp;В связи с чем я и решил сделать слепок того, что знаю о unit тестировании. Для начала хотелось бы поговорить о том, что должна представлять из себя легко тестируемая система.<a name='more'></a><br />Как&nbsp;ни странно&nbsp;это прозвучит, но unit тестировать нужно, когда в системе есть эти самые юниты, которые нужно протестировать. Юнит — это единичная, неделимая операция.<br /><div>Чем больше юнит может, тем меньше он является юнитом. В ООП единственным достойным&nbsp;претендентом&nbsp;на звание юнита является метод. Соответственно разработка unit тестов требует наиболее "низкого" уровня проектирования системы — проектирования на уровне методов. Такое проектирование очень редко делается на стадии дизайна функциональности или компонента и остается на совести разработчика. Подобный подход вполне оправдан, иначе дизайн-документы в течении первых месяцев разработки превратились бы в многотомные фолианты.&nbsp;</div><div>Проектирование на уровне методов — это тема отдельной книги, однако, лично для себя я выделил следующие принципы проектирования, ориентированного на unit тестирование:</div><div><br /></div><div><b>Краткость</b></div><div>Является логическим следствием принципа "функциональной связности"&nbsp;(в узких кругах широко известен как functional cohesion). Однако, для простоты и в качестве руководства к действию я бы сказал именно "краткость".</div><div>Краткость подразумевает выполнение строго определенного действия. В качестве идеализированного примера можно привести языковой оператор.</div><div>Краткости проще всего достичь, разбив "крупный" метод на более "мелкие", следующие конкретному функциональному назначению. Например, если метод должен найти значение массива, соответствующее определенному условию, а затем вычислить значение производное от него. У вас уже есть три метода: первый&nbsp;—&nbsp;перебирает массив и ищет значение, второй — производит вычисления, третий&nbsp;—&nbsp;вызывает первые два;&nbsp;и два unit теста&nbsp;—&nbsp;на первый и второй методы. Третий метод в плане unit тестирования ценности не представляет, а только увеличивает покрытие.</div><div><br /></div><div><b>Ограниченность влияния</b></div><div>Так же является следствием другого принципа "low coupling". Метод не должен обновлять поля 85-ти близлежащих классов и &nbsp;впридачу выводить сообщения в stdout. Идеальный для unit тестирования метод не должен изменять состояния вообще, в крайнем случае такое изменение состояния должно производится один раз за все время исполнения метода.&nbsp;</div><div><br /></div><div><b>Простота</b></div><div>Собственно результат применения KISS. Метод хорошо поддающийся тестированию как правило содержит не более 3 ветвей исполнения, говоря попросту в методе не должно быть более трех if/while/else/for и так далее. Достигается путем выноса:</div><ul><li>логики проверки входных параметров за пределы метода. Например, путем декларативной проверки (Spring Framework предоставляет отличный класс Assert, именно для этих целей)</li><li>разнообразных операций поиска, проверки, вычисления в утилитный классы и методы</li><li>методов в "под-методы"</li></ul><div>Если система уже написана и ее код не соответствует вышеописанным требованиям, то unit тесты точно не для Вас. Если Вы не собираетесь тратить достаточно времени на проектирование методов и unit тестов,&nbsp;то unit тесты точно не для Вас.&nbsp;Применение unit тестов обязательно требует приведение кода именно к описанному виду. Все остальное будет работать, как метеоролог — "ошибается один раз, но каждый день".</div><div><br /></div><div>Внимательный читатель наверняка заметил, что все описанное выше, является ни чем иным, как расширенным толкованием перевода слова "unit" — блок, единица на русский язык. Собственно ничего другого о unit тестировании понимать и не нужно. Все остальное уже "обвес" и приходит с опытом.</div>
</div>
